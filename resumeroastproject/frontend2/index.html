<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Random Quote Generator</title>
    <link rel="stylesheet" href="frontcs.css">
    <style>
        /* CSS to hide the audio player */
        #myAudio {
            display: none; /* Hide the audio player */
        }
    </style>
</head>
<body>
    <div id="person"><img src="../person2.svg" alt="" width="100%"></div>
    <div class="container">
        <div id="image"><img src="../code-forces.svg" alt="" id="logo"> </div>
        <div class="title">CODEFORCES ROASTER</div>
        <p class="subtitle">Enter Username And Get Roasted  &#128578;</p>
        
        <!-- Audio Player -->
        <audio id="myAudio">
            <source src="" type="audio/mpeg"> <!-- Replace with your actual MP3 file path -->
            Your browser does not support the audio element.
        </audio>
        
        <div class="user-input">
            <input type="text" id="username" placeholder="Enter username...">
            <button id="getUserInfo" class="getUserInfo">Roast</button>
        </div>
        
        <div class="box">
            <div class="text" id="text">
                <p id="quotes" class="quotes"></p>
            </div>
        </div>
    </div>
<div id="loader-container">
    <div class="psoload">
        <div class="straight"></div>
        <div class="curve"></div>
        <!-- <div class="center"></div> -->
        <div class="inner"></div>
      </div>
    </div>

    <script>
        const quotes = document.getElementById('quotes');
        const getUserInfoBtn = document.getElementById('getUserInfo');
        const audioPlayer = document.getElementById('myAudio');

        const getUserInfo = async () => {
            const username = document.getElementById('username').value.trim();

            const loader = document.getElementById("loader-container");
            const button = document.getElementById("getUserInfo");

            // Disable button and change its text immediately
            button.disabled = true;
            button.textContent = 'Roasting...';

            if (username === '') {
                alert('Oops! Username cannot be empty');
                // Enable button back if there's an issue
                button.disabled = false;
                button.textContent = 'Roast';
                return;
            }

            try {
                loader.style.display = "flex"; // Show loader
                document.getElementById("quotes").innerHTML = "";
                const response = await fetch('/api/userinfo', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username })
                });

                if (!response.ok) {
                    throw new Error('Failed to fetch user info');
                }

                const data = await response.json();
                var finalData = `${data.handle}`;
                document.querySelector('.box').classList.add('active'); // Display the box

                // Typing effect
                var i = 0;
                var txt = finalData;
                var speed = 50;

                function typeWriter() {
                    if (i < txt.length) {
                        document.getElementById("quotes").innerHTML += txt.charAt(i);
                        i++;
                        setTimeout(typeWriter, speed);
                    } else {
                        // Enable button after quotes are fully displayed
                        button.disabled = false;
                        button.textContent = 'Roast';
                    }
                }

                setTimeout(() => { typeWriter(); }, 1000);

                // Play random MP3
                setTimeout(() => { playRandomMP3(); }, 2000);

                // Hide loader after quotes are displayed and audio is played
                setTimeout(() => {
                    loader.style.display = "none";
                }, 1000);

            } catch (error) {
                console.error('Error fetching user info:', error);
                alert('Error fetching User Info');
                // Enable button back in case of error
               
                button.disabled = false;
                button.textContent = 'Roast';
                setTimeout(() => {
                    loader.style.display = "none";
                }, 1000);

            }
        };

        const playRandomMP3 = () => {
            const mp3Array = [
                "../sound1.wav", 
                "../sound2.wav", 
                "../sound3.wav", 
                "../sound4.wav", 
                "../sound5.wav", 
                // Replace with your actual MP3 file paths
            ];

            // Get a random index from the mp3Array
            const randomIndex = Math.floor(Math.random() * mp3Array.length);
            const randomMP3 = mp3Array[randomIndex];

            console.log('Attempting to play:', randomMP3);

            // Set the source and play the audio
            audioPlayer.src = randomMP3;
            audioPlayer.currentTime = 0; // Reset the playback position to start
            audioPlayer.play();

            console.log('Audio playback started');
        };

        getUserInfoBtn.addEventListener('click', (e) => {
            e.preventDefault(); // Prevent default button behavior
            getUserInfo();
        });

        // Prevent form submission on Enter key press
        document.getElementById('username').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault(); // Prevent default form submission
                getUserInfo();
            }
        });
    </script>
    <!-- <script src="script.js"></script> -->
</body>
</html>
